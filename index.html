<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Van Dort Letselschade Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <script type="module">
        // Firebase SDKs worden hier één keer correct geïmporteerd.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, addDoc, updateDoc, deleteDoc, query, serverTimestamp, arrayUnion, where, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getDatabase, ref, onValue, set, onDisconnect, serverTimestamp as rtdbServerTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // Expose Firebase modules to the window object for easy access
        window.firebase = {
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
            getFirestore, doc, collection, onSnapshot, addDoc, updateDoc, deleteDoc, query, serverTimestamp, arrayUnion, where, writeBatch,
            getDatabase, ref, onValue, set, onDisconnect, rtdbServerTimestamp,
            getStorage, storageRef, uploadBytes, getDownloadURL
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f9; }
        .bg-primary { background-color: #0E3190; }
        .text-primary { color: #0E3190; }
        .border-primary { border-color: #0E3190; }
        .hover\:bg-primary-dark:hover { background-color: #0A246A; }
        .bg-accent { background-color: #19AACD; }
        .text-accent { color: #19AACD; }
        .border-accent { border-color: #19AACD; }
        .bg-subtle { background-color: #F8FBFC; }
        .readonly-input { background-color: #e9ecef; opacity: 0.7; cursor: not-allowed; }
        .disabled-section { opacity: 0.6; pointer-events: none; }
        .invalid-input { border-color: #ef4444; box-shadow: 0 0 0 1px #ef4444; }
        #notification {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            padding: 12px 24px; border-radius: 8px; color: white; font-weight: 500;
            z-index: 1050; transition: opacity 0.5s, transform 0.5s;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-backdrop { z-index: 1040; }
        .modal { z-index: 1050; }

        /* Schadestaat Specifieke Stijlen */
        .drag-handle { cursor: move; }
        .sortable-ghost { opacity: 0.4; background-color: #A4DFEB; }
        .schadepost-hoofd { border-bottom: 2px solid #e5e7eb; padding-bottom: 1rem; }
        .sub-regel { background-color: #f9fafb; border-left: 3px solid #19AACD; }
        .border-validation-error { border-color: #E53E3E; }
        .border-validation-warning { border-color: #F6AD55; }
        .validation-panel { background: linear-gradient(135deg, #FED7D7 0%, #FEE2E2 100%); }
        .validation-item { background: rgba(255,255,255,0.7); }

        /* Jurisprudentie Specifieke Stijlen */
        .result-item-selected {
            background-color: #EBF8FF !important;
            border-color: #19AACD !important;
        }
        details > summary {
            cursor: pointer;
            list-style: none; /* Verwijder standaard pijl */
        }
        details > summary::-webkit-details-marker {
            display: none; /* Verwijder standaard pijl in Chrome */
        }
        details > summary::before {
            content: '►';
            margin-right: 0.5rem;
            font-size: 0.8em;
            transition: transform 0.2s;
        }
        details[open] > summary::before {
            transform: rotate(90deg);
        }
        .filter-checkbox-group {
            column-count: 2;
        }
        @media (max-width: 768px) {
            .filter-checkbox-group {
                column-count: 1;
            }
        }
        #jurisprudentie-loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #19AACD;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container">

        <div id="hub-page">
            <div class="flex flex-col min-h-screen">
                <header class="bg-white shadow-md w-full p-4 flex justify-between items-center z-10">
                    <div class="flex items-center">
                        <img src="https://i.postimg.cc/B690tTpb/temp-Image8-Bf-XYq.avif" alt="Van Dort Letselschade Logo" class="h-12 mr-4">
                        <div>
                            <h1 class="text-2xl font-bold text-primary">Kantoor Hub</h1>
                            <p class="text-sm text-gray-500">Uw centrale startpunt</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-sm font-medium">Ingelogd als:</span>
                        <select id="user-selector" class="text-sm font-bold border-gray-300 rounded-md shadow-sm"></select>
                    </div>
                </header>
                <main class="flex-grow p-4 md:p-6 lg:p-8">
                    <div class="w-full max-w-7xl mx-auto space-y-8">
                        
                        <div class="flex flex-col lg:flex-row gap-8">
                            <div id="daily-briefing-widget" class="bg-white p-6 rounded-lg shadow-xl lg:w-1/2">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Mijn Dagoverzicht</h2>
                                <div id="daily-briefing-container" class="space-y-3"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col lg:w-1/2">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Team Prikbord</h2>
                                <p class="text-gray-600 mb-6 flex-grow">Centrale plek voor mededelingen, vragen en memo's.</p>
                                <div class="space-y-3 mb-6">
                                    <div class="flex justify-between items-center"><span class="font-medium">Nieuwe berichten voor u:</span><span id="hub-prikbord-private-messages" class="font-bold px-3 py-1 rounded-full">0</span></div>
                                </div>
                                <button id="btn-go-to-prikbord" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">Ga naar Prikbord &rarr;</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Mijn Deadlines</h2>
                                <p class="text-gray-600 mb-6 flex-grow">Beheer en stel deadlines voor teamleden.</p>
                                <div class="space-y-3 mb-6">
                                    <div class="flex justify-between items-center"><span class="font-medium">Openstaande Deadlines:</span><span id="hub-deadlines-open" class="font-bold px-3 py-1 rounded-full">0</span></div>
                                </div>
                                <button id="btn-go-to-deadlines" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">Beheer Deadlines &rarr;</button>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Derdengeld Verantwoording</h2>
                                <p class="text-gray-600 mb-6 flex-grow">Beheer en verantwoord de derdengelden.</p>
                                <div class="space-y-3 mb-6">
                                    <div class="flex justify-between items-center"><span class="font-medium">Mijn Goedkeuringen:</span><span id="hub-derdengeld-approvals" class="font-bold px-3 py-1 rounded-full">0</span></div>
                                    <div class="flex justify-between items-center"><span class="font-medium">Mijn Openstaande Taken:</span><span id="hub-derdengeld-tasks" class="font-bold px-3 py-1 rounded-full">0</span></div>
                                </div>
                                <button id="btn-go-to-derdengeld" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">Open Derdengeld App &rarr;</button>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Schadestaten</h2>
                                <div class="relative mb-4">
                                    <input type="search" id="schadestaat-widget-search" placeholder="Zoek dossiernummer..." class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg shadow-sm">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                                    </div>
                                </div>
                                <div id="schadestaten-widget-list" class="space-y-2 flex-grow mb-4 h-32 overflow-y-auto">
                                </div>
                                <button id="btn-new-schadestaat" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">Schadestaat Toevoegen &rarr;</button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="bg-white p-6 rounded-lg shadow-xl">
                                    <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Aanwezigheid Team</h2>
                                    <div id="presence-container" class="flex flex-wrap gap-x-8 gap-y-4"></div>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-xl">
                                    <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Handige Links</h2>
                                    <div id="quick-links-container" class="space-y-3"></div>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col">
                                 <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Standaard Documenten</h2>
                                 <p class="text-gray-600 mb-6 flex-grow">Vind en download de benodigde formulieren en formats.</p>
                                 <div class="space-y-3 mb-6">
                                     <div class="flex justify-between items-center"><span class="font-medium">Totaal Documenten:</span><span id="hub-docs-total" class="font-bold px-3 py-1 rounded-full">0</span></div>
                                 </div>
                                 <button id="btn-go-to-docs" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">Open Documenten &rarr;</button>
                             </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col">
                                <h2 class="text-xl font-bold text-primary mb-4 border-b pb-2">Jurisprudentie Zoeker</h2>
                                <p class="text-gray-600 mb-6 flex-grow">Doorzoek direct de live Rechtspraak.nl database.</p>
                                <div class="space-y-3 mb-6">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium">Geïntegreerde Bron:</span>
                                        <span class="font-bold px-3 py-1 rounded-full bg-blue-100 text-blue-800">Rechtspraak.nl</span>
                                    </div>
                                </div>
                                <button id="btn-go-to-jurisprudentie" class="mt-auto w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg shadow-sm">
                                    Start Rolfies Superzoeker &rarr;
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <div id="prikbord-page" class="hidden"></div>
    <div id="derdengeld-app-container" class="hidden"></div>
    <div id="deadlines-page" class="hidden"></div>
    <div id="docs-page" class="hidden"></div>
    <div id="schadestaat-page" class="hidden"></div>
    
    <div id="jurisprudentie-page" class="hidden">
        <div class="flex flex-col h-screen bg-subtle">
            <header class="bg-white shadow-md w-full p-4 flex justify-between items-center z-10 shrink-0">
                <div class="flex items-center">
                    <img src="https://i.postimg.cc/B690tTpb/temp-Image8-Bf-XYq.avif" alt="Van Dort Letselschade Logo" class="h-12 mr-4">
                    <div>
                        <h1 class="text-2xl font-bold text-primary">Rolfies Superzoeker</h1>
                        <p class="text-sm text-gray-500">Live Jurisprudentie Navigator</p>
                    </div>
                </div>
                <button class="btn-back-to-hub text-sm font-medium text-gray-600 hover:text-primary">&larr; Terug naar Hub</button>
            </header>

            <main class="flex-grow grid grid-cols-12 gap-4 p-4 overflow-hidden">

                <aside class="col-span-12 lg:col-span-3 bg-white rounded-lg shadow-lg flex flex-col h-full overflow-hidden">
                    <div class="p-4 border-b">
                        <h2 class="text-lg font-semibold text-primary">Zoekopdracht</h2>
                    </div>
                    <div id="jurisprudentie-form" class="p-4 space-y-4 overflow-y-auto">
                        <div>
                            <label for="jurisprudentie-omnibox" class="text-sm font-medium text-gray-700">Zoekterm</label>
                            <textarea id="jurisprudentie-omnibox" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary" placeholder="Voer trefwoorden in..."></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div><label for="filter-date-start" class="text-sm font-medium">Datum na:</label><input type="date" id="filter-date-start" class="mt-1 w-full rounded-md border-gray-300 text-sm"></div>
                            <div><label for="filter-date-end" class="text-sm font-medium">Datum voor:</label><input type="date" id="filter-date-end" class="mt-1 w-full rounded-md border-gray-300 text-sm"></div>
                        </div>

                        <details id="filter-details-instances" class="border-t pt-4">
                            <summary class="font-semibold text-gray-800">Instanties</summary>
                            <div class="mt-2 space-y-2 pl-2 filter-checkbox-group">
                                </div>
                        </details>

                        <details id="filter-details-law-areas" class="border-t pt-4">
                            <summary class="font-semibold text-gray-800">Rechtsgebieden</summary>
                            <div class="mt-2 space-y-2 pl-2 filter-checkbox-group">
                                </div>
                        </details>
                    </div>
                    <div class="mt-auto p-4 border-t bg-gray-50">
                        <button id="jurisprudentie-search-button" class="w-full bg-accent hover:bg-opacity-90 text-white font-bold py-3 rounded-lg shadow-sm">Zoeken</button>
                    </div>
                </aside>

                <section class="col-span-12 lg:col-span-4 bg-white rounded-lg shadow-lg flex flex-col h-full overflow-hidden">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h2 class="text-lg font-semibold text-primary">Resultaten (<span id="jurisprudentie-result-count">0</span>)</h2>
                        <div class="text-sm text-gray-400">
                            Sorteer op: <span class="font-semibold text-gray-600">Nieuwste datum</span>
                        </div>
                    </div>
                    <div class="flex-grow relative">
                        <div id="jurisprudentie-results-list" class="absolute inset-0 overflow-y-auto p-2 space-y-2">
                            <div class="flex items-center justify-center h-full text-center p-10 text-gray-500">
                                Voer een zoekopdracht in om te beginnen.
                            </div>
                        </div>
                        <div id="jurisprudentie-loader-container" class="hidden absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center">
                            <div id="jurisprudentie-loader"></div>
                        </div>
                    </div>
                    <div id="jurisprudentie-pagination" class="p-2 border-t flex justify-between items-center text-sm">
                        <button id="pagination-prev" class="px-4 py-2 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">&larr; Vorige</button>
                        <span id="pagination-info" class="text-gray-600"></span>
                        <button id="pagination-next" class="px-4 py-2 rounded-md hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">Volgende &rarr;</button>
                    </div>
                </section>

                <article class="col-span-12 lg:col-span-5 bg-white rounded-lg shadow-lg flex flex-col h-full overflow-hidden">
                    <div id="jurisprudentie-detail-pane-placeholder" class="flex flex-col items-center justify-center h-full text-center text-gray-500 p-8">
                       <svg class="h-12 w-12 text-gray-300 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" /></svg>
                        <h3 class="font-semibold text-lg text-gray-700">Selecteer een uitspraak</h3>
                        <p>Klik op een resultaat in de lijst om hier de details te bekijken.</p>
                    </div>
                    <div id="jurisprudentie-detail-pane-content" class="hidden flex-col h-full">
                        <div class="border-b border-gray-200">
                            <nav id="jurisprudentie-detail-tabs" class="-mb-px flex space-x-6 px-4" aria-label="Tabs">
                            </nav>
                        </div>
                        <div id="jurisprudentie-detail-tab-content" class="p-4 overflow-y-auto">
                        </div>
                    </div>
                </article>
            </main>
        </div>
    </div>
    
    <div id="notification" class="hidden"></div>
    <div id="modal-container"></div>

    <script type="module">
    // --- FIREBASE & GLOBALE CONFIGURATIE ---

    // 1. Haal de Firebase modules op die in de <head> zijn geëxporteerd.
    const { 
        initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
        getFirestore, doc, collection, onSnapshot, addDoc, updateDoc, deleteDoc, query, serverTimestamp, arrayUnion, where, writeBatch,
        getDatabase, ref, onValue, set, onDisconnect, rtdbServerTimestamp,
        getStorage, storageRef, uploadBytes, getDownloadURL 
    } = window.firebase;
    
    // 2. Jouw unieke project sleutels (deze zijn correct!)
    const firebaseConfig = {
      apiKey: "AIzaSyDsWX2rv9RlFHUpZe4TVPZxPoi7CchQd0A",
      authDomain: "vdl-hub.firebaseapp.com",
      projectId: "vdl-hub",
      storageBucket: "vdl-hub.appspot.com",
      messagingSenderId: "1002801206953",
      appId: "1:1002801206953:web:a6d81eed27a0bb641dfbb8",
      measurementId: "G-5ZF5L22ZRZ"
    };

    // 3. Initialiseer Firebase en alle benodigde services
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const rtdb = getDatabase(app);
    const storage = getStorage(app);
    
    // --- GLOBALE STAAT & CONSTANTEN ---
    const COLLEAGUES = ['Ine van Dort', 'Rolf van Dort', 'Maaike', 'Esther', 'Simone', 'Sandra'];
    const QUICK_LINKS = [
        { name: 'ANWB Routeplanner', url: 'https://www.anwb.nl/verkeer/routeplanner' },
        { name: 'NIS', url: 'https://nis.letselschaderaad.nl/' },
        { name: 'Rechtspraak.nl', url: 'https://www.rechtspraak.nl/' },
    ];
    let currentUserDisplayName = COLLEAGUES[0];
    let currentUserId = null;
    let currentOpenMessageId = null;
    let currentSchadestaatId = null;
    
    let allMessages = [];
    let allDeadlines = [];
    let standardDocuments = [];
    let allSchadestaten = [];
    let unsubscribers = [];

    // --- AANWEZIGHEIDSSYSTEEM (REAL-TIME) ---
    function setupPresenceSystem() {
        if (!currentUserId || !currentUserDisplayName) return;

        const userStatusDatabaseRef = ref(rtdb, `/status/${currentUserDisplayName}`);
        const infoConnectedRef = ref(rtdb, '.info/connected');

        onValue(infoConnectedRef, (snapshot) => {
            if (snapshot.val() === false) {
                return; // Gebruiker is niet verbonden
            }
            
            onDisconnect(userStatusDatabaseRef).set({
                state: 'offline',
                last_changed: rtdbServerTimestamp()
            }).then(() => {
                set(userStatusDatabaseRef, {
                    state: 'online',
                    last_changed: rtdbServerTimestamp()
                });
            });
        });

        const statusRef = ref(rtdb, 'status/');
        onValue(statusRef, (snapshot) => {
            const statuses = snapshot.val() || {};
            renderPresence(statuses);
        });
    }

    function renderPresence(statuses) {
        const container = document.getElementById('presence-container');
        if (!container) return;
        const fiveMinutesAgo = Date.now() - (5 * 60 * 1000);

        container.innerHTML = COLLEAGUES.map(colleague => {
            const userStatus = statuses[colleague];
            const isPresent = userStatus && userStatus.state === 'online';
            const statusClass = isPresent ? 'bg-green-500' : 'bg-gray-400';
            const textClass = isPresent ? 'text-gray-800' : 'text-gray-500';
            return `<div class="flex items-center gap-2"><span class="h-3 w-3 rounded-full ${statusClass}"></span><span class="${textClass}">${colleague}</span></div>`;
        }).join('');
    }

    // --- UTILITY FUNCTIES ---
    function sanitizeInput(text) {
        if (typeof text !== 'string') return '';
        const temp = document.createElement('div');
        temp.textContent = text;
        return temp.innerHTML;
    }

    function requestNotificationPermission() {
        if ("Notification" in window && Notification.permission === "default") {
            Notification.requestPermission();
        }
    }

    function showBrowserNotification(title, body) {
        if (Notification.permission === "granted") {
            new Notification(title, { body });
        }
    }

    function parseAndStyleMentions(text) {
        if (!text) return '';
        text = sanitizeInput(text);
        const colleaguesRegex = new RegExp(`@(${COLLEAGUES.join('|')})`, 'g');
        return text.replace(colleaguesRegex, `<strong class="bg-blue-100 text-blue-800 px-1 rounded">$&</strong>`);
    }

    // --- INITIALISATIE VAN DE APP ---
    document.addEventListener('DOMContentLoaded', () => {
        onAuthStateChanged(auth, user => {
            if (user) {
                currentUserId = user.uid;
                initializeApplication();
            } else {
                signInAnonymously(auth).catch(error => {
                    console.error("Anoniem inloggen mislukt:", error);
                    showNotification('Kon niet verbinden met de server.', 'error');
                });
            }
        });
    });

    function initializeApplication() {
        setupUserSelector();
        initFirestoreListeners();
        setupPresenceSystem(); // Eerste aanroep
        initializeDerdengeldApp();
        initializeSchadestaatApp();
        setupEventListeners();
        showPage('hub-page');
        requestNotificationPermission();
    }
    
    function setupUserSelector() {
        const selector = document.getElementById('user-selector');
        selector.innerHTML = COLLEAGUES.map(name => `<option value="${name}" ${name === currentUserDisplayName ? 'selected' : ''}>${name}</option>`).join('');
        selector.addEventListener('change', (e) => {
            currentUserDisplayName = e.target.value;
            if (window.derdengeldApp) window.derdengeldApp.setCurrentUser(currentUserDisplayName);
            updateDashboard();
            if (document.getElementById('prikbord-page').style.display !== 'none') renderPrikbord();
            if (document.getElementById('deadlines-page').style.display !== 'none') renderDeadlinesPage();
            if (document.getElementById('docs-page').style.display !== 'none') renderDocsPage();
            setupPresenceSystem(); // Opnieuw aanroepen na gebruikerwissel
        });
    }

    function initFirestoreListeners() {
        unsubscribers.forEach(unsub => unsub());
        unsubscribers = [];

        const messagesQuery = query(collection(db, "messages"));
        const unsubMessages = onSnapshot(messagesQuery, (querySnapshot) => {
            allMessages = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            if (document.getElementById('prikbord-page').style.display !== 'none') renderMessages();
            if (currentOpenMessageId) renderMessageDetailModal(currentOpenMessageId);
            updateDashboard();
        });
        unsubscribers.push(unsubMessages);

        const deadlinesQuery = query(collection(db, "deadlines"));
        const unsubDeadlines = onSnapshot(deadlinesQuery, (querySnapshot) => {
            allDeadlines = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            if (document.getElementById('deadlines-page').style.display !== 'none') renderAllDeadlines();
            updateDashboard();
        });
        unsubscribers.push(unsubDeadlines);

        const docsQuery = query(collection(db, "documents"));
        const unsubDocs = onSnapshot(docsQuery, (querySnapshot) => {
            standardDocuments = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            if (document.getElementById('docs-page').style.display !== 'none') renderAllDocuments();
            updateDashboard();
        });
        unsubscribers.push(unsubDocs);

        const schadestatenQuery = query(collection(db, "schadestaten"));
        const unsubSchadestaten = onSnapshot(schadestatenQuery, (querySnapshot) => {
            allSchadestaten = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderSchadestatenWidget();
        });
        unsubscribers.push(unsubSchadestaten);
    }

    // --- NAVIGATIE ---
    const allPages = ['hub-page', 'prikbord-page', 'derdengeld-app-container', 'deadlines-page', 'docs-page', 'schadestaat-page', 'jurisprudentie-page'];

    function showPage(pageId, context = null) {
        allPages.forEach(p => document.getElementById(p)?.classList.add('hidden'));
        document.getElementById(pageId)?.classList.remove('hidden');
        
        const pageActions = {
            'hub-page': () => updateDashboard(),
            'prikbord-page': () => renderPrikbord(),
            'deadlines-page': () => renderDeadlinesPage(),
            'docs-page': () => renderDocsPage(),
            'jurisprudentie-page': () => initializeJurisprudentieApp(),
            'schadestaat-page': () => {
                if (window.schadestaatApp) {
                    window.schadestaatApp.loadState(context?.id || null);
                }
            }
        };
        pageActions[pageId]?.();
    }

    function showDerdengeldPage(pageId) {
        showPage('derdengeld-app-container');
        const derdengeldPages = ['derdengeld-dashboard-page', 'derdengeld-new-form-page', 'derdengeld-task-view-page', 'derdengeld-report-page'];
        derdengeldPages.forEach(p => document.getElementById(p)?.classList.add('hidden'));
        document.getElementById(pageId)?.classList.remove('hidden');
        if (pageId === 'derdengeld-dashboard-page' && window.derdengeldApp) {
            window.derdengeldApp.renderDashboard();
        }
    }

    // --- HUB LOGICA & RENDERING ---
    function updateDashboard() {
        updateHubTileWidgets();
        renderDailyBriefingWidget();
        renderQuickLinksWidget();
    }

    function updateHubTileWidgets() {
        const setBadge = (elementId, value, alwaysGray = false) => {
            const badge = document.getElementById(elementId);
            if (!badge) return;
            badge.textContent = value;
            badge.className = 'font-bold px-3 py-1 rounded-full';

            const colorClasses = {
                'hub-prikbord-private-messages': ['bg-blue-100', 'text-blue-800'],
                'hub-deadlines-open': ['bg-red-100', 'text-red-800'],
                'hub-derdengeld-approvals': ['bg-yellow-100', 'text-yellow-800'],
                'hub-derdengeld-tasks': ['bg-blue-100', 'text-blue-800'],
                'hub-docs-total': ['bg-gray-100', 'text-gray-800']
            };
            
            if (value > 0 && !alwaysGray) {
                badge.classList.add(...colorClasses[elementId]);
            } else {
                badge.classList.add('bg-gray-100', 'text-gray-800');
            }
        };

        const unreadPrivateMessages = allMessages.filter(m => m.isPrivate && m.recipients.includes(currentUserDisplayName) && !(m.readBy?.includes(currentUserDisplayName))).length;
        setBadge('hub-prikbord-private-messages', unreadPrivateMessages);

        if (window.derdengeldApp) {
            const stats = window.derdengeldApp.getStats();
            setBadge('hub-derdengeld-approvals', stats.approvals);
            setBadge('hub-derdengeld-tasks', stats.myTasks);
        }

        const deadlineStats = getDeadlineStats();
        setBadge('hub-deadlines-open', deadlineStats.open);
        
        setBadge('hub-docs-total', standardDocuments.length, true);
    }

    function renderQuickLinksWidget() {
        const container = document.getElementById('quick-links-container');
        if (!container) return;
        container.innerHTML = QUICK_LINKS.map(link => `
            <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                <span class="text-primary font-medium">${link.name}</span>
            </a>
        `).join('');
    }

    function renderDailyBriefingWidget() {
        const container = document.getElementById('daily-briefing-container');
        if(!container) return;

        const briefingItems = [];
        const unreadPrikbord = allMessages.filter(m => m.isPrivate && m.recipients.includes(currentUserDisplayName) && !(m.readBy?.includes(currentUserDisplayName))).length;
        if (unreadPrikbord > 0) briefingItems.push({ text: `U heeft <strong>${unreadPrikbord}</strong> nieuwe privéberichten.`, actionId: 'btn-go-to-prikbord' });

        if (window.derdengeldApp) {
            const derdengeldStats = window.derdengeldApp.getStats();
            if (derdengeldStats.approvals > 0) briefingItems.push({ text: `Er wachten <strong>${derdengeldStats.approvals}</strong> verzoeken op uw goedkeuring.`, actionId: 'btn-go-to-derdengeld' });
            if (derdengeldStats.myTasks > 0) briefingItems.push({ text: `U heeft <strong>${derdengeldStats.myTasks}</strong> openstaande derdengeld taken.`, actionId: 'btn-go-to-derdengeld' });
        }

        const deadlineStats = getDeadlineStats();
        if (deadlineStats.open > 0) briefingItems.push({ text: `U heeft <strong>${deadlineStats.open}</strong> openstaande deadlines.`, actionId: 'btn-go-to-deadlines' });
        
        if (briefingItems.length === 0) {
            container.innerHTML = `<p class="text-gray-500">Geen openstaande actiepunten. Een rustige dag!</p>`;
        } else {
            container.innerHTML = briefingItems.map(item => `
                <div class="flex items-center gap-3 p-2 rounded-md hover:bg-gray-100 cursor-pointer briefing-item" data-action-id="${item.actionId}">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <span>${item.text}</span>
                </div>
            `).join('');
        }
    }

    function renderSchadestatenWidget(filterText = '') {
        const container = document.getElementById('schadestaten-widget-list');
        if (!container) return;

        const lowerCaseFilter = filterText.toLowerCase();
        const filtered = allSchadestaten.filter(item => item.data?.algemeen?.dossiernummer.toLowerCase().includes(lowerCaseFilter));
        const sorted = [...filtered].sort((a, b) => (b.lastModified?.seconds || 0) - (a.lastModified?.seconds || 0));
        
        if (sorted.length === 0) {
            container.innerHTML = `<p class="text-sm text-gray-500 text-center">${filterText ? 'Geen resultaten.' : 'Nog geen schadestaten.'}</p>`;
        } else {
            container.innerHTML = sorted.map(item => {
                const dossiernummer = item.data.algemeen?.dossiernummer || 'Onbekend';
                const date = item.lastModified?.seconds ? new Date(item.lastModified.seconds * 1000).toLocaleDateString('nl-NL', { day: '2-digit', month: 'short', year: 'numeric' }) : 'Onbekend';
                return `
                    <div class="p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer schadestaat-widget-item" data-id="${item.id}">
                        <p class="font-semibold text-primary">${dossiernummer}</p>
                        <p class="text-xs text-gray-500">Laatst bewerkt: ${date}</p>
                    </div>`;
            }).join('');
        }
    }

    // --- MODAL FUNCTIES ---
    function openModal(innerHTML) {
        const modalContainer = document.getElementById('modal-container');
        modalContainer.innerHTML = `<div class="modal-backdrop fixed inset-0 bg-gray-800 bg-opacity-75"></div><div class="modal fixed inset-0 flex items-center justify-center p-4">${innerHTML}</div>`;
    }

    function closeModal() {
        currentOpenMessageId = null;
        document.getElementById('modal-container').innerHTML = '';
    }

    // --- OVERIGE MODULES (Prikbord, Deadlines, etc. zijn hier ingeklapt voor leesbaarheid. In het echte bestand staat hier de volledige, ongewijzigde code) ---
    // [CODE VOOR PRIKBORD]
    // [CODE VOOR DEADLINES]
    // [CODE VOOR DOCUMENTEN]
    // [CODE VOOR DERDENGELD]
    // [CODE VOOR SCHADESTAAT]
    // [CODE VOOR EVENT LISTENERS]
    // [CODE VOOR NOTIFICATIES]
    
    // --- JURISPRUDENTIE SUPERZOEKER MODULE ---
    let jurisprudentieResults = [];
    let currentPage = 1;
    let totalResults = 0;
    const resultsPerPage = 20;
    
    // Data voor de geavanceerde filters
    const INSTANCES_DATA = [
        { name: 'Hoge Raad', value: 'HR' },
        { name: 'Raad van State', value: 'RVS' },
        { name: 'Centrale Raad van Beroep', value: 'CRVB' },
        { name: 'College van Beroep', value: 'CBB' },
        { name: 'Gerechtshoven', value: 'GERECHTSHOOF', children: [
            { name: 'Amsterdam', value: 'GHAMS' },
            { name: 'Den Haag', value: 'GHDHA' },
            { name: 'Arnhem-Leeuwarden', value: 'GHARL' },
            { name: '\'s-Hertogenbosch', value: 'GHSHE' }
        ]},
        { name: 'Rechtbanken', value: 'RECHTBANK', children: [
            { name: 'Amsterdam', value: 'RBAMS' },
            { name: 'Den Haag', value: 'RBDHA' },
            { name: 'Gelderland', value: 'RBGEL' },
            { name: 'Limburg', value: 'RBLIM' },
            { name: 'Midden-Nederland', value: 'RBMNE' },
            { name: 'Noord-Holland', value: 'RBNHO' },
            { name: 'Noord-Nederland', value: 'RBNNE' },
            { name: 'Oost-Brabant', value: 'RBOBR' },
            { name: 'Overijssel', value: 'RBOVE' },
            { name: 'Rotterdam', value: 'RBROT' },
            { name: 'Zeeland-West-Brabant', value: 'RBZWB' }
        ]}
    ];

    const LAW_AREAS_DATA = [
        { name: 'Bestuursrecht', value: 'bestuursrecht', children: [
            { name: 'Ambtenarenrecht', value: 'bestuursrecht/ambtenarenrecht' },
            { name: 'Belastingrecht', value: 'bestuursrecht/belastingrecht' },
            { name: 'Omgevingsrecht', value: 'bestuursrecht/omgevingsrecht' },
            { name: 'Socialezekerheidsrecht', value: 'bestuursrecht/socialezekerheidsrecht' },
            { name: 'Vreemdelingenrecht', value: 'bestuursrecht/vreemdelingenrecht' }
        ]},
        { name: 'Civiel recht', value: 'civiel', children: [
            { name: 'Aanbestedingsrecht', value: 'civiel/aanbestedingsrecht' },
            { name: 'Arbeidsrecht', value: 'civiel/arbeidsrecht' },
            { name: 'Burgerlijk procesrecht', value: 'civiel/burgerlijkprocesrecht' },
            { name: 'Insolventierecht', value: 'civiel/insolventierecht' },
            { name: 'Personen- en familierecht', value: 'civiel/personen-enfamilierecht' },
            { name: 'Verbintenissenrecht', value: 'civiel/verbintenissenrecht' }
        ]},
        { name: 'Internationaal', value: 'internationaal', children: [
            { name: 'Mensenrechten', value: 'internationaal/mensenrechten' },
            { name: 'Volkenrecht', value: 'internationaal/volkenrecht' },
        ]},
        { name: 'Strafrecht', value: 'strafrecht', children: [
            { name: 'Materieel strafrecht', value: 'strafrecht/materieelstrafrecht' },
            { name: 'Strafprocesrecht', value: 'strafrecht/strafprocesrecht' },
        ]}
    ];

    function createCheckbox(item, name) {
        return `
            <div class="text-sm">
                <label class="flex items-center">
                    <input type="checkbox" name="${name}" value="${item.value}" class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="ml-2">${item.name}</span>
                </label>
            </div>
        `;
    }

    function createFilterGroup(group, name) {
        const childrenHtml = group.children ? group.children.map(child => createCheckbox(child, name)).join('') : '';
        return `
            <div>
                <label class="font-semibold text-sm flex items-center">
                    <input type="checkbox" data-group-parent="${group.value}" name="${name}" value="${group.value}" class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary">
                    <span class="ml-2">${group.name}</span>
                </label>
                <div class="pl-6 mt-1 space-y-1">
                    ${childrenHtml}
                </div>
            </div>
        `;
    }

    function populateFilters() {
        const instancesContainer = document.querySelector('#filter-details-instances .filter-checkbox-group');
        const lawAreasContainer = document.querySelector('#filter-details-law-areas .filter-checkbox-group');

        instancesContainer.innerHTML = INSTANCES_DATA.map(group => {
            return group.children ? createFilterGroup(group, 'filter-instance') : createCheckbox(group, 'filter-instance');
        }).join('');
        
        lawAreasContainer.innerHTML = LAW_AREAS_DATA.map(group => {
            return group.children ? createFilterGroup(group, 'filter-law-area') : createCheckbox(group, 'filter-law-area');
        }).join('');
    }
    
    function setupFilterListeners() {
        document.querySelectorAll('input[data-group-parent]').forEach(parentCheckbox => {
            parentCheckbox.addEventListener('change', (e) => {
                const groupContainer = e.target.closest('div');
                const childCheckboxes = groupContainer.querySelectorAll('input[type="checkbox"]:not([data-group-parent])');
                childCheckboxes.forEach(child => {
                    child.checked = e.target.checked;
                });
            });
        });
    }

    function initializeJurisprudentieApp() {
        populateFilters();
        
        const searchButton = document.getElementById('jurisprudentie-search-button');
        const resultsList = document.getElementById('jurisprudentie-results-list');
        const tabsContainer = document.getElementById('jurisprudentie-detail-tabs');
        const prevButton = document.getElementById('pagination-prev');
        const nextButton = document.getElementById('pagination-next');

        if (!searchButton.dataset.listener) {
            searchButton.addEventListener('click', () => {
                currentPage = 1;
                handleJurisprudentieSearch();
            });
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    handleJurisprudentieSearch();
                }
            });
            nextButton.addEventListener('click', () => {
                const totalPages = Math.ceil(totalResults / resultsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    handleJurisprudentieSearch();
                }
            });
            
            setupFilterListeners();
            searchButton.dataset.listener = 'true';
        }
        if (!resultsList.dataset.listener) {
            resultsList.addEventListener('click', handleResultClick);
            resultsList.dataset.listener = 'true';
        }
        if (!tabsContainer.dataset.listener) {
            tabsContainer.addEventListener('click', handleTabClick);
            tabsContainer.dataset.listener = 'true';
        }
    }

    async function handleJurisprudentieSearch() {
        const omnibox = document.getElementById('jurisprudentie-omnibox');
        const resultsList = document.getElementById('jurisprudentie-results-list');
        const resultCount = document.getElementById('jurisprudentie-result-count');
        const loader = document.getElementById('jurisprudentie-loader-container');
        const searchButton = document.getElementById('jurisprudentie-search-button');

        const searchTerm = omnibox.value.trim();
        if (!searchTerm) {
            showNotification('Voer een zoekterm in.', 'error');
            return;
        }

        loader.classList.remove('hidden');
        searchButton.disabled = true;
        searchButton.textContent = 'Bezig...';
        
        resultsList.innerHTML = '';
        resultCount.textContent = '...';
        document.getElementById('jurisprudentie-detail-pane-placeholder').classList.remove('hidden');
        document.getElementById('jurisprudentie-detail-pane-content').classList.add('hidden');
        updatePaginationUI();
        
        const getCheckedValues = (name) => {
            return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value);
        };
        
        const requestBody = {
            query: searchTerm,
            dateStart: document.getElementById('filter-date-start').value,
            dateEnd: document.getElementById('filter-date-end').value,
            instances: getCheckedValues('filter-instance'),
            lawAreas: getCheckedValues('filter-law-area'),
            page: currentPage
        };

        try {
            const response = await fetch('/.netlify/functions/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`Serverfout: ${response.status} ${await response.text()}`);
            }

            const data = await response.json();
            jurisprudentieResults = data.results || [];
            totalResults = data.total || 0;

            resultCount.textContent = totalResults;
            if (jurisprudentieResults.length > 0) {
                resultsList.innerHTML = jurisprudentieResults.map(createResultCard).join('');
            } else {
                resultsList.innerHTML = `<div class="text-center p-10 text-gray-500">Geen resultaten gevonden voor deze zoekopdracht.</div>`;
            }
        } catch (error) {
            console.error('Fout bij het zoeken:', error);
            resultsList.innerHTML = `<div class="text-center p-10 text-red-500">Er is een fout opgetreden. Probeer het opnieuw.</div>`;
            showNotification(`Zoekopdracht mislukt: ${error.message}`, 'error');
            totalResults = 0;
        } finally {
            loader.classList.add('hidden');
            searchButton.disabled = false;
            searchButton.textContent = 'Zoeken';
            updatePaginationUI();
        }
    }
    
    function updatePaginationUI() {
        const paginationContainer = document.getElementById('jurisprudentie-pagination');
        const prevButton = document.getElementById('pagination-prev');
        const nextButton = document.getElementById('pagination-next');
        const pageInfo = document.getElementById('pagination-info');

        if (totalResults === 0) {
            paginationContainer.classList.add('hidden');
            return;
        }
        
        paginationContainer.classList.remove('hidden');

        const totalPages = Math.ceil(totalResults / resultsPerPage);
        const startItem = (currentPage - 1) * resultsPerPage + 1;
        const endItem = Math.min(currentPage * resultsPerPage, totalResults);
        
        pageInfo.textContent = `${startItem}-${endItem} van ${totalResults}`;
        
        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage >= totalPages;
    }

    function createResultCard(result) {
        const formatDate = (dateString) => new Date(dateString).toLocaleDateString('nl-NL', { year: 'numeric', month: 'long', day: 'numeric' });
        return `
            <div class="p-3 border rounded-md hover:bg-subtle hover:shadow-md cursor-pointer jurisprudentie-result-item border-l-4 border-transparent" data-id="${result.id}">
                <h4 class="font-semibold text-primary text-md">${sanitizeInput(result.title)}</h4>
                <div class="text-xs text-gray-500 mt-1">
                    <span>${sanitizeInput(result.id)}</span> | <span>${formatDate(result.updated)}</span>
                </div>
            </div>`;
    }

    function handleResultClick(e) {
        const resultItem = e.target.closest('.jurisprudentie-result-item');
        if (!resultItem) return;

        const resultId = resultItem.dataset.id;
        
        document.querySelectorAll('.jurisprudentie-result-item').forEach(el => el.classList.remove('result-item-selected'));
        resultItem.classList.add('result-item-selected');

        document.getElementById('jurisprudentie-detail-pane-placeholder').classList.add('hidden');
        const detailPane = document.getElementById('jurisprudentie-detail-pane-content');
        detailPane.classList.remove('hidden');
        detailPane.classList.add('flex');

        renderDetailTabs(resultId, 'summary');
    }
    
    function handleTabClick(e) {
        const tabButton = e.target.closest('.jurisprudentie-tab-button');
        if (!tabButton) return;
        
        const resultId = tabButton.dataset.resultId;
        const tabId = tabButton.dataset.tabId;
        
        renderDetailTabs(resultId, tabId);
    }
    
    function renderDetailTabs(resultId, activeTabId = 'summary') {
        const resultData = jurisprudentieResults.find(r => r.id === resultId);
        if (!resultData) return;
        
        const tabsContainer = document.getElementById('jurisprudentie-detail-tabs');
        const tabContentContainer = document.getElementById('jurisprudentie-detail-tab-content');

        const tabs = [
            { id: 'summary', name: 'Samenvatting' },
            { id: 'details', name: 'Details' },
            { id: 'link', name: 'Origineel' },
        ];

        tabsContainer.innerHTML = tabs.map(tab => {
            const isActive = tab.id === activeTabId;
            const classes = isActive ? 'border-primary text-primary font-semibold' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';
            return `<button data-tab-id="${tab.id}" data-result-id="${resultId}" class="jurisprudentie-tab-button whitespace-nowrap py-3 px-1 border-b-2 text-sm ${classes}">${tab.name}</button>`;
        }).join('');

        let content = '';
        switch(activeTabId) {
            case 'summary':
                content = `
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-primary">${sanitizeInput(resultData.title)}</h3>
                        <div class="prose prose-sm max-w-none bg-subtle p-3 rounded-md border">
                            ${resultData.summary ? sanitizeInput(resultData.summary).replace(/\n/g, '<br>') : '<i>Geen samenvatting beschikbaar.</i>'}
                        </div>
                    </div>`;
                break;
            case 'details':
                const formattedDate = new Date(resultData.updated).toLocaleString('nl-NL', { dateStyle: 'full', timeStyle: 'short'});
                content = `
                    <div class="space-y-2 text-sm">
                        <div class="flex"><strong class="w-28 flex-shrink-0">ECLI:</strong><span>${sanitizeInput(resultData.id)}</span></div>
                        <div class="flex"><strong class="w-28 flex-shrink-0">Laatst bijgewerkt:</strong><span>${formattedDate}</span></div>
                        <div class="flex"><strong class="w-28 flex-shrink-0">Bron:</strong><span>Rechtspraak.nl</span></div>
                    </div>`;
                break;
            case 'link':
                content = `<p>Klik op de link om de originele uitspraak direct op Rechtspraak.nl te bekijken:</p>
                           <a href="${resultData.link}" target="_blank" rel="noopener noreferrer" class="text-primary font-semibold hover:underline break-all">${resultData.link}</a>`;
                break;
        }
        tabContentContainer.innerHTML = content;
    }
    </script>
</body>
</html>
